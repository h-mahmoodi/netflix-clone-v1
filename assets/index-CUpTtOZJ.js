import{r as t,s as G,j as s,a as D,v as b,q as C,w as I}from"./main-DKSfX3_Z.js";import{M}from"./index-CS-cpyAf.js";import{A as k}from"./index-CVLtKXyq.js";import{u as F,a as L}from"./index-B5P1rCrm.js";import"./index-Vgt4Y7Cs.js";import"./netflix-wkEmooaA.js";const R="_container_wlv4o_1",$="_inputBox_wlv4o_6",q="_placeholder_wlv4o_12",A="_placeholderDeactive_wlv4o_17",z="_selectedOptions_wlv4o_21",H="_selectedOption_wlv4o_21",K="_input_wlv4o_6",Q="_modalBox_wlv4o_35",T="_modalBoxOption_wlv4o_42",U="_modalBoxOptionSelected_wlv4o_47",r={container:R,inputBox:$,placeholder:q,placeholderDeactive:A,selectedOptions:z,selectedOption:H,input:K,modalBox:Q,modalBoxOption:T,modalBoxOptionSelected:U},J=({placeholder:d="SelectInput",options:p=[],value:l,onChange:x,icon:h="fi-rr-filter",isLoading:_=!1})=>{const[i,v]=t.useState(l||[]),[O,f]=t.useState(!1),[a,n]=t.useState(!1),[o,c]=t.useState(""),j=t.useRef(null),[S,w]=t.useState(p),N=G(B),y=()=>{var e;(e=j.current)==null||e.focus(),f(!0),n(!0)};function B(){var e;(e=j.current)==null||e.focus(),c(""),f(!1),n(!1)}const P=(e,u)=>{e.stopPropagation(),v(g=>(x(g.filter(m=>m.value!==u.value)),g.filter(m=>m.value!==u.value)))},E=e=>{var g;i.find(m=>m.value===e.value)||(v(m=>(x([...m,e]),[...m,e])),c(""),(g=j.current)==null||g.focus())};return t.useEffect(()=>{const e=p.filter(u=>u.label.toLocaleLowerCase().includes(o.toLocaleLowerCase().trim()));if(console.log("newOptions",e),w(e),e.length===0){n(!1);return}},[o,p]),t.useEffect(()=>{v(l)},[l]),s.jsxs("div",{className:r.container,ref:N,children:[_?s.jsx("span",{className:"flex items-center px-3 text-xl animate-spin ",children:s.jsx("i",{className:"flex fi fi-rr-spinner"})}):s.jsx("span",{className:"flex items-center px-3 text-xl ",children:s.jsx("i",{className:`flex fi ${h}`})}),s.jsxs("div",{className:r.inputBox,onClick:y,children:[s.jsx("span",{className:`${r.placeholder} ${i.length>0||O?r.placeholderDeactive:r.placeholderActive}`,children:d}),s.jsxs("div",{className:r.selectedOptions,children:[i.map((e,u)=>s.jsxs("div",{className:r.selectedOption,children:[s.jsx("span",{className:"px-2 py-1",children:e.label}),s.jsx("span",{className:"flex items-center bg-zinc-800 px-1 hover:bg-red-700 cursor-pointer",onClick:g=>P(g,e),children:s.jsx("i",{className:"flex fi fi-rr-cross-small "})})]},u)),s.jsx("input",{className:r.input,value:o,onChange:e=>c(e.target.value),ref:j,style:{width:`${(o.length+5)*8}px`}})]})]}),a&&s.jsx("div",{className:r.modalBox,children:S.map(e=>s.jsx("div",{className:i.find(u=>u.value===e.value)?r.modalBoxOptionSelected:r.modalBoxOption,onClick:()=>E(e),children:s.jsx("span",{children:e.label})},e.value))})]})},V=()=>{const{data:d,isFetching:p,error:l}=D({queryKey:["GetGenres"],queryFn:b});return{data:d,isFetching:p,error:l}},W=({selectedOptions:d,setSelectedOptions:p})=>{const[l,x]=C(),[h,_]=t.useState([]),{data:i,isFetching:v,error:O}=V(),f=t.useMemo(()=>{var n;return((n=l.get("filterByGenres"))==null?void 0:n.split(",").map(o=>h.find(c=>c.value===o)).filter(Boolean))||[]},[h,l]);console.log(f),t.useEffect(()=>{p(f)},[f]);const a=t.useCallback(n=>{n.length!==0?x(o=>({...Object.fromEntries(o.entries()),filterByGenres:n.map(c=>c.value).join(",")})):x(o=>{const c=new URLSearchParams(o);return c.delete("filterByGenres"),c})},[x]);return t.useEffect(()=>{if(i!=null&&i.genres){const n=i.genres.map(o=>({label:o.name,value:`${o.id}`}));_(n)}},[i]),O?s.jsx("p",{children:"Error Loading ExplorePage Select Genre"}):s.jsx(J,{placeholder:"Filter By Genres",options:h,value:d,onChange:a,isLoading:v})},X=[{display:"Name",field:"title"},{display:"IMDb Score",field:"vote_average"},{display:"Popularity",field:"vote_count"},{display:"Released Date",field:"release_date"}],ae=()=>{const[d,p]=t.useState([]),{data:l,isFetching:x,error:h,fetchNextPage:_,hasNextPage:i,isFetchingNextPage:v}=F({queryKey:["ExploreMoviesPage",`&with_genres=${d.map(a=>a.value).join(",")}`],queryFn:({pageParam:a})=>I(a,`&with_genres=${d.map(n=>n.value).join(",")}`),getNextPageParam:a=>{if(a.page<a.total_pages)return a.page+1},initialPageParam:1}),O=L({fetchNextPage:_,hasNextPage:!!i,isLoading:v}),f=t.useMemo(()=>(l==null?void 0:l.pages.flatMap(a=>a.results))||[],[l]);return t.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[]),s.jsxs("div",{children:[s.jsx(k,{title:"Explore Movies"}),s.jsxs("div",{className:"container mx-auto mt-5 flex gap-3",children:[s.jsx(M,{movies:f,isFetching:x,error:h,sortOptions:X,defaultGrid:4,ref:O}),s.jsx("div",{className:`w-96 h-screen  mt-2 sticky top-[81px] flex flex-col gap-5
         `,children:s.jsx("div",{className:" bg-zinc-950 rounded-md py-4 px-3",children:s.jsx(W,{selectedOptions:d,setSelectedOptions:p})})})]})]})};export{ae as default};
