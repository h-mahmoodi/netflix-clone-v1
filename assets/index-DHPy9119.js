import{r as t,s as G,j as s,a as D,v as b,q as C,w as I}from"./main-C8GEAw96.js";import{M}from"./index-2Hqyf-f4.js";import{A as k}from"./index-FOgUHRrQ.js";import{u as F,a as L}from"./index-DT5EG7Or.js";import"./index-utSb4dlB.js";import"./netflix-wkEmooaA.js";const R="_container_feil4_1",$="_inputBox_feil4_6",q="_placeholder_feil4_12",A="_placeholderDeactive_feil4_17",z="_selectedOptions_feil4_21",H="_selectedOption_feil4_21",K="_input_feil4_6",Q="_modalBox_feil4_35",T="_modalBoxOption_feil4_42",o={container:R,inputBox:$,placeholder:q,placeholderDeactive:A,selectedOptions:z,selectedOption:H,input:K,modalBox:Q,modalBoxOption:T},U=({placeholder:p="SelectInput",options:d=[],value:a,onChange:f,icon:h="fi-rr-filter",isLoading:_=!1})=>{const[r,g]=t.useState(a||[]),[O,x]=t.useState(!1),[l,n]=t.useState(!1),[i,c]=t.useState(""),j=t.useRef(null),[S,N]=t.useState(d),y=G(P),B=()=>{var e;(e=j.current)==null||e.focus(),x(!0),n(!0)};function P(){var e;(e=j.current)==null||e.focus(),c(""),x(!1),n(!1)}const E=(e,u)=>{e.stopPropagation(),g(v=>(f(v.filter(m=>m.value!==u.value)),v.filter(m=>m.value!==u.value)))},w=e=>{var v;r.find(m=>m.value===e.value)||(g(m=>(f([...m,e]),[...m,e])),c(""),(v=j.current)==null||v.focus())};return t.useEffect(()=>{const e=d.filter(u=>u.label.toLocaleLowerCase().includes(i.toLocaleLowerCase().trim()));if(console.log("newOptions",e),N(e),e.length===0){n(!1);return}},[i,d]),t.useEffect(()=>{g(a)},[a]),s.jsxs("div",{className:o.container,ref:y,children:[_?s.jsx("span",{className:"flex items-center px-3 text-xl animate-spin ",children:s.jsx("i",{className:"flex fi fi-rr-spinner"})}):s.jsx("span",{className:"flex items-center px-3 text-xl ",children:s.jsx("i",{className:`flex fi ${h}`})}),s.jsxs("div",{className:o.inputBox,onClick:B,children:[s.jsx("span",{className:`${o.placeholder} ${r.length>0||O?o.placeholderDeactive:o.placeholderActive}`,children:p}),s.jsxs("div",{className:o.selectedOptions,children:[r.map((e,u)=>s.jsxs("div",{className:o.selectedOption,children:[s.jsx("span",{className:"px-2 py-1",children:e.label}),s.jsx("span",{className:"flex items-center bg-zinc-800 px-1 hover:bg-red-700 cursor-pointer",onClick:v=>E(v,e),children:s.jsx("i",{className:"flex fi fi-rr-cross-small "})})]},u)),s.jsx("input",{className:o.input,value:i,onChange:e=>c(e.target.value),ref:j,style:{width:`${(i.length+5)*8}px`}})]})]}),l&&s.jsx("div",{className:o.modalBox,children:S.map(e=>s.jsx("div",{className:r.find(u=>u.value===e.value)?o.modalBoxOptionSelected:o.modalBoxOption,onClick:()=>w(e),children:s.jsx("span",{children:e.label})},e.value))})]})},J=()=>{const{data:p,isFetching:d,error:a}=D({queryKey:["GetGenres"],queryFn:b});return{data:p,isFetching:d,error:a}},V=({selectedOptions:p,setSelectedOptions:d})=>{const[a,f]=C(),[h,_]=t.useState([]),{data:r,isFetching:g,error:O}=J(),x=t.useMemo(()=>{var n;return((n=a.get("filterByGenres"))==null?void 0:n.split(",").map(i=>h.find(c=>c.value===i)).filter(Boolean))||[]},[h,a]);console.log(x),t.useEffect(()=>{d(x)},[x]);const l=t.useCallback(n=>{n.length!==0?f(i=>({...Object.fromEntries(i.entries()),filterByGenres:n.map(c=>c.value).join(",")})):f(i=>{const c=new URLSearchParams(i);return c.delete("filterByGenres"),c})},[f]);return t.useEffect(()=>{if(r!=null&&r.genres){const n=r.genres.map(i=>({label:i.name,value:`${i.id}`}));_(n)}},[r]),O?s.jsx("p",{children:"Error Loading ExplorePage Select Genre"}):s.jsx(U,{placeholder:"Filter By Genres",options:h,value:p,onChange:l,isLoading:g})},W=[{display:"Name",field:"title"},{display:"IMDb Score",field:"vote_average"},{display:"Popularity",field:"vote_count"},{display:"Released Date",field:"release_date"}],ae=()=>{const[p,d]=t.useState([]),{data:a,isFetching:f,error:h,fetchNextPage:_,hasNextPage:r,isFetchingNextPage:g}=F({queryKey:["ExploreMoviesPage",`&with_genres=${p.map(l=>l.value).join(",")}`],queryFn:({pageParam:l})=>I(l,`&with_genres=${p.map(n=>n.value).join(",")}`),getNextPageParam:l=>{if(l.page<l.total_pages)return l.page+1},initialPageParam:1}),O=L({fetchNextPage:_,hasNextPage:!!r,isLoading:g}),x=t.useMemo(()=>(a==null?void 0:a.pages.flatMap(l=>l.results))||[],[a]);return t.useEffect(()=>{window.scrollTo({top:0,left:0,behavior:"smooth"})},[]),s.jsxs("div",{children:[s.jsx(k,{title:"Explore Movies"}),s.jsxs("div",{className:"container mx-auto mt-5 flex gap-3",children:[s.jsx(M,{movies:x,isFetching:f,error:h,sortOptions:W,defaultGrid:4,ref:O}),s.jsx("div",{className:`w-96 h-screen  mt-2 sticky top-[81px] flex flex-col gap-5
         `,children:s.jsx("div",{className:" bg-zinc-950 rounded-md py-4 px-3",children:s.jsx(V,{selectedOptions:p,setSelectedOptions:d})})})]})]})};export{ae as default};
